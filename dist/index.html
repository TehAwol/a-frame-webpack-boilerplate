<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>VR</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@vmaster/dist/aframe-physics-system.js"></script>
  <script src="bundle.js"></script>
</head>

<body>
  <a-scene physics="driver: ammo; debug: false; debug: true;">

    <a-plane id="floor" position="0 0 0" rotation="-90 0 0" width="20" height="20" material="color: #86bf54"
      ammo-body="type: static; emitCollisionEvents: true;" ammo-shape="type: box"></a-plane>

    <!-- <a-entity id="cylinder" geometry="primitive: cylinder; height: 1.2; radius: .05;" position="0 1 -1"
      material="color: #c26421" cylinder ammo-body="type: dynamic" ammo-shape="type: cylinder"></a-entity> -->

      <a-assets>
        <a-mixin id="ball-geometry" geometry="primitive: sphere; radius: .3"></a-mixin>
        <a-mixin id="ball-body" random-position="min: -10 0 -2; max: 10 3 -10" ammo-body="type: dynamic; emitCollisionEvents: true; activationState: disableDeactivation"></a-mixin>
        <a-mixin id="ball-shape" ammo-shape="type: sphere;"></a-mixin>
        <a-mixin id="ball-material" material="color: yellow"></a-mixin>
        <a-mixin id="ball-params" throw-ball collision-ball></a-mixin>
      </a-assets>
   
      <a-entity entity-generator="mixin: ball-geometry ball-body ball-shape ball-material ball-params; num: 5"></a-entity>

    <!-- <a-sphere id="ball" radius=".3" material="color: yellow" position="3 1 -4"
      throw-ball
      ammo-body="type: dynamic; emitCollisionEvents: true; activationState: disableDeactivation"
      ammo-shape="type: sphere"></a-sphere> -->

    <a-entity id="camera-rig" position="0 0 0">
      <a-entity id="head" camera wasd-controls look-controls="pointerLockEnabled: true" position="0 1.8 0"></a-entity>
      <a-entity oculus-touch-controls="hand: left"></a-entity>
      <a-entity oculus-touch-controls="hand: right">
        <a-entity id="sword" geometry="primitive: cylinder; height: 1; radius: .03;" position="0 .3 -.35"
          rotation="-45 0 0" material="color: red" cylinder ammo-body="type: static; mass: 5"
          ammo-shape="type: cylinder"></a-entity>
      </a-entity>
    </a-entity>

  </a-scene>
  <script>
    // document.querySelector('#test').addEventListener('collidestart', evt => {
    //   console.log(evt)
    // })

    // cylinder.addEventListener('body-loaded', evt => {
    //   console.log('asd')
    //   const force = new Ammo.btVector3(0, 0, 0);
    //   const pos = new Ammo.btVector3(cylinder.object3D.position.x, cylinder.object3D.position.y, cylinder.object3D
    //     .position.z)
    //   cylinder.body.applyForce(force, pos);
    //   Ammo.destroy(force);
    //   Ammo.destroy(pos);
    // });

    // let ball = document.querySelector('#ball');
    // ball.addEventListener('body-loaded', evt => {
    //   throwBall(ball)
    // })

    // function throwBall(ball) {
    //   const force = new Ammo.btVector3(0, 200, 100);
    //   const pos = new Ammo.btVector3(ball.object3D.position);
    //   ball.body.applyForce(force, pos);
    //   Ammo.destroy(force);
    //   Ammo.destroy(pos);
    // }
  </script>
</body>

</html>